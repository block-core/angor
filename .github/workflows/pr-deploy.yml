name: PR Testing Deploy
on:
  # Manual PR 
  workflow_dispatch:
    inputs:
      pr_number:
        description: 'PR Number to deploy'
        required: true
        type: string
permissions:
  contents: write
  pull-requests: write
jobs:
  pr-test-deploy:
    name: Build and Deploy PR for Testing
    runs-on: ubuntu-latest
    
    env:
      PROJECT_NAME: "Angor"
      SOLUTION_PATH: "src/Angor.sln"
      PROJECT_PATH: "src/Angor/Client/Angor.Client.csproj"
      
    steps:
    - name: Get PR details
      id: pr
      uses: actions/github-script@v7
      with:
        script: |
          const { data: pr } = await github.rest.pulls.get({
            owner: context.repo.owner,
            repo: context.repo.repo,
            pull_number: ${{ inputs.pr_number }}
          });
          
          core.setOutput('ref', pr.head.sha);
          core.setOutput('head_ref', pr.head.ref);
          core.setOutput('title', pr.title);
          core.setOutput('author', pr.user.login);
          
          return pr;
    
    - uses: actions/checkout@v4
      with:
        ref: ${{ steps.pr.outputs.ref }}
    # Deploy to angor-debug repo gh-pages (domain => debug.angor.io)
    - name: Deploy to debug.angor.io
      uses: JamesIves/github-pages-deploy-action@v4
      with:
        branch: main
        folder: publish/wwwroot
        repository-name: ${{ github.repository_owner }}/angor-debug
        token: ${{ secrets.ANGOR_DEBUG_DEPLOY_TOKEN }}
        commit-message: "Deploy PR #${{ inputs.pr_number }} - ${{ steps.pr.outputs.title }}"
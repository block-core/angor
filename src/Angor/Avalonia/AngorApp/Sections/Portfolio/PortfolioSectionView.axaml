<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="530"
             x:Class="AngorApp.Sections.Portfolio.PortfolioSectionView"
             xmlns:p="clr-namespace:AngorApp.Sections.Portfolio"
             xmlns:ui="clr-namespace:Zafiro.UI;assembly=Zafiro.UI"
             xmlns:items="clr-namespace:AngorApp.Sections.Portfolio.Items"
             xmlns:a="clr-namespace:AngorApp.UI.Controls"
             xmlns:design="clr-namespace:AngorApp.Design"
             x:DataType="p:IPortfolioSectionViewModel">

    <UserControl.Resources>
        <ControlTheme x:Key="Item" TargetType="HeaderedContainer">
            <Setter Property="Template">
                <ControlTemplate>
                    <EdgePanel StartContent="{TemplateBinding Header}" EndContent="{TemplateBinding Content}" />
                </ControlTemplate>
            </Setter>
        </ControlTheme>
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="Card StackPanel > HeaderedContainer">
            <Setter Property="Theme" Value="{StaticResource Item}" />
        </Style>
    </UserControl.Styles>

    <Design.DataContext>
        <p:PortfolioSectionViewModelDesign>
            <p:PortfolioSectionViewModelDesign.InvestedProjects>
                <p:PortfolioProjectDesign InvestmentStatus="FounderSignaturesReceived" FounderStatus="Approved" IsInvestmentCompleted="False" Name="Project 1" LogoUri="https://test.angor.io/assets/img/no-image.jpg">
                    <p:PortfolioProjectDesign.Target>
                        <design:DesignTimeAmount Sats="12000000" />
                    </p:PortfolioProjectDesign.Target>
                    <p:PortfolioProjectDesign.Raised>
                        <design:DesignTimeAmount Sats="4400000" />
                    </p:PortfolioProjectDesign.Raised>
                </p:PortfolioProjectDesign>
                <p:PortfolioProjectDesign FounderStatus="Approved" InvestmentStatus="PendingFounderSignatures" Name="Project 2" IsInvestmentCompleted="True" LogoUri="https://test.angor.io/assets/img/no-image.jpg">
                    <p:PortfolioProjectDesign.Target>
                        <design:DesignTimeAmount Sats="12000000" />
                    </p:PortfolioProjectDesign.Target>
                    <p:PortfolioProjectDesign.Raised>
                        <design:DesignTimeAmount Sats="5404000" />
                    </p:PortfolioProjectDesign.Raised>
                </p:PortfolioProjectDesign>
                <p:PortfolioProjectDesign FounderStatus="Approved" InvestmentStatus="Invested" Name="Project 2" IsInvestmentCompleted="True" LogoUri="https://test.angor.io/assets/img/no-image.jpg">
                    <p:PortfolioProjectDesign.Target>
                        <design:DesignTimeAmount Sats="12000000" />
                    </p:PortfolioProjectDesign.Target>
                    <p:PortfolioProjectDesign.Raised>
                        <design:DesignTimeAmount Sats="5404000" />
                    </p:PortfolioProjectDesign.Raised>
                </p:PortfolioProjectDesign>
            </p:PortfolioSectionViewModelDesign.InvestedProjects>
        </p:PortfolioSectionViewModelDesign>
    </Design.DataContext>

    <a:PageContainer>
        <ScrollViewer>
            <DockPanel HorizontalSpacing="20" VerticalSpacing="20">
                <Card Theme="{StaticResource WideCard}" DockPanel.Dock="Top" Header="Portfolio" Subheader="Check your project investments">
                    <Card.HeaderEndContent>
                        <UniformGrid ColumnSpacing="10" Rows="1">
                            <IconButton HorizontalAlignment="Stretch" Command="{Binding LoadWallet}">
                                Refresh
                                <IconButton.Icon>
                                    <ui:Icon Source="fa-arrows-rotate" />
                                </IconButton.Icon>
                            </IconButton>
                            <IconButton HorizontalAlignment="Stretch" Command="{Binding GoToPenalties}">
                                Penalties
                                <IconButton.Icon>
                                    <ui:Icon Source="fa-unlock" />
                                </IconButton.Icon>
                            </IconButton>
                        </UniformGrid>
                    </Card.HeaderEndContent>
                </Card>

                <Loading IsLoading="{Binding LoadWallet.IsExecuting^}" LoadingText="Loading wallet. Please wait." DockPanel.Dock="Top">
                    <StackPanel Classes="BigGap">
                        <BalancedWrapGrid DockPanel.Dock="Top" MinItemWidth="260">
                            <Card Theme="{StaticResource LeftItemCard}" Header="Funded Projects" Subheader="{Binding InvestorStats.FundedProjects, FallbackValue=0}">
                                <Card.HeaderStartContent>
                                    <ui:Icon Source="svg:/Assets/portfolio.svg" />
                                </Card.HeaderStartContent>
                            </Card>
                            <Card Theme="{StaticResource LeftItemCard}" Header="Total Invested" Subheader="{Binding InvestorStats.TotalInvested.ShortDecimalString, FallbackValue=0}">
                                <Card.HeaderStartContent>
                                    <ui:Icon Source="svg:/Assets/btc.svg" />
                                </Card.HeaderStartContent>
                            </Card>
                            <Card Theme="{StaticResource LeftItemCard}" Header="Recovered To Penalty" Subheader="{Binding InvestorStats.RecoveredToPenalty.ShortDecimalString, FallbackValue=0}">
                                <Card.HeaderStartContent>
                                    <ui:Icon Source="svg:/Assets/recovery.svg" />
                                </Card.HeaderStartContent>
                            </Card>
                            <Card Theme="{StaticResource LeftItemCard}" Header="Projects In Recovery" Subheader="{Binding InvestorStats.ProjectsInRecovery, FallbackValue=0}">
                                <Card.HeaderStartContent>
                                    <ui:Icon Source="svg:/Assets/recovery.svg" />
                                </Card.HeaderStartContent>
                            </Card>
                        </BalancedWrapGrid>

                        <Loading IsLoading="{Binding LoadPortfolio.IsExecuting^}" LoadingText="Loading your portfolio">
                            <ItemsControl Classes="ShowEmptyContent" ItemsSource="{Binding InvestedProjects}" Empty.Content="Nothing to show">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Classes="BigGap" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <items:PortfolioProjectView />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Loading>
                    </StackPanel>
                </Loading>
            </DockPanel>
        </ScrollViewer>
    </a:PageContainer>
</UserControl>
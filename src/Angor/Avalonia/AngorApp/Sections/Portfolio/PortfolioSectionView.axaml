<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d" d:DesignWidth="730"
             x:Class="AngorApp.Sections.Portfolio.PortfolioSectionView"
             xmlns:p="clr-namespace:AngorApp.Sections.Portfolio"
             xmlns:ui="clr-namespace:Zafiro.UI;assembly=Zafiro.UI"
             xmlns:items="clr-namespace:AngorApp.Sections.Portfolio.Items"
             xmlns:a="clr-namespace:AngorApp.UI.Controls"
             xmlns:design="clr-namespace:AngorApp.Design"
             d:DesignHeight="800"
             x:DataType="p:IPortfolioSectionViewModel">
    
    <Interaction.Behaviors>
        <LoadedTrigger>
            <InvokeCommandAction IsEnabled="{Binding !!!InvestedProjects.Count}" Command="{Binding LoadPortfolio}" />
        </LoadedTrigger>
    </Interaction.Behaviors>

    <UserControl.Resources>
        <ControlTheme x:Key="Item" TargetType="HeaderedContainer">
            <Setter Property="Template">
                <ControlTemplate>
                    <EdgePanel StartContent="{TemplateBinding Header}" EndContent="{TemplateBinding Content}" />
                </ControlTemplate>
            </Setter>
        </ControlTheme>
    </UserControl.Resources>

    <UserControl.Styles>
        <Style Selector="Card StackPanel > HeaderedContainer">
            <Setter Property="Theme" Value="{StaticResource Item}" />
        </Style>
    </UserControl.Styles>

    <Design.DataContext>
        <p:PortfolioSectionViewModelDesign>
            <p:PortfolioSectionViewModelDesign.InvestedProjects>
                <p:PortfolioProjectDesign InvestmentStatus="FounderSignaturesReceived" FounderStatus="Approved" IsInvestmentCompleted="False" Name="Project 1" LogoUri="https://test.angor.io/assets/img/no-image.jpg">
                    <p:PortfolioProjectDesign.Target>
                        <design:DesignTimeAmount Sats="12000000" />
                    </p:PortfolioProjectDesign.Target>
                    <p:PortfolioProjectDesign.Raised>
                        <design:DesignTimeAmount Sats="4400000" />
                    </p:PortfolioProjectDesign.Raised>
                </p:PortfolioProjectDesign>
                <p:PortfolioProjectDesign FounderStatus="Approved" InvestmentStatus="PendingFounderSignatures" Name="Project 2" IsInvestmentCompleted="True" LogoUri="https://test.angor.io/assets/img/no-image.jpg">
                    <p:PortfolioProjectDesign.Target>
                        <design:DesignTimeAmount Sats="12000000" />
                    </p:PortfolioProjectDesign.Target>
                    <p:PortfolioProjectDesign.Raised>
                        <design:DesignTimeAmount Sats="5404000" />
                    </p:PortfolioProjectDesign.Raised>
                </p:PortfolioProjectDesign>
                <p:PortfolioProjectDesign FounderStatus="Approved" InvestmentStatus="Invested" Name="Project 2" IsInvestmentCompleted="True" LogoUri="https://test.angor.io/assets/img/no-image.jpg">
                    <p:PortfolioProjectDesign.Target>
                        <design:DesignTimeAmount Sats="12000000" />
                    </p:PortfolioProjectDesign.Target>
                    <p:PortfolioProjectDesign.Raised>
                        <design:DesignTimeAmount Sats="5404000" />
                    </p:PortfolioProjectDesign.Raised>
                </p:PortfolioProjectDesign>
            </p:PortfolioSectionViewModelDesign.InvestedProjects>
        </p:PortfolioSectionViewModelDesign>
    </Design.DataContext>

    <a:PageContainer Container.Name="RootPanel" Container.Sizing="Width">
        <DockPanel HorizontalSpacing="20" VerticalSpacing="20">
            <Card Theme="{StaticResource WideCard}" DockPanel.Dock="Top" Header="Portfolio" Subheader="Check your project investments">
                <Card.HeaderEndContent>
                    <Grid ColumnSpacing="10" ColumnDefinitions="Auto *">
                        <Button HorizontalAlignment="Stretch" Command="{Binding LoadPortfolio}" Content="{Icon fa-arrows-rotate}" />
                        <IconButton Grid.Column="1" HorizontalAlignment="Stretch" Command="{Binding GoToPenalties}" Icon="{Icon fa-unlock}" Content="Penalties" />
                    </Grid>
                </Card.HeaderEndContent>
            </Card>
            <Loading IsLoading="{Binding IsLoading^}" LoadingText="Your portfolio is loading. Please wait.">
                <ScrollViewer>
                    <StackPanel Classes="BigGap">
                        <BalancedWrapGrid DockPanel.Dock="Top">
                            <BalancedWrapGrid.Styles>
                                <ContainerQuery Name="RootPanel" Query="min-width:0">
                                    <Style Selector="BalancedWrapGrid">
                                        <Setter Property="MinItemWidth" Value="190" />
                                    </Style>
                                    <Style Selector="Card">
                                        <Setter Property="Theme" Value="{StaticResource CompactLeftItemCard}" />
                                    </Style>
                                </ContainerQuery>
                                <ContainerQuery Name="RootPanel" Query="min-width:600">
                                    <Style Selector="BalancedWrapGrid">
                                        <Setter Property="MinItemWidth" Value="250" />
                                    </Style>
                                    <Style Selector="Card">
                                        <Setter Property="Theme" Value="{StaticResource LeftItemCard}" />
                                    </Style>
                                </ContainerQuery>
                            </BalancedWrapGrid.Styles>
                            <Card Header="Funded Projects" Subheader="{Binding InvestorStats.FundedProjects, FallbackValue=0}">
                                <Card.HeaderStartContent>
                                    <ui:Icon Source="svg:/Assets/portfolio.svg" />
                                </Card.HeaderStartContent>
                            </Card>
                            <Card Header="Total Invested" Subheader="{Binding InvestorStats.TotalInvested.ShortDecimalString, FallbackValue=0}">
                                <Card.HeaderStartContent>
                                    <ui:Icon Source="svg:/Assets/btc.svg" />
                                </Card.HeaderStartContent>
                            </Card>
                            <Card Header="Recovered To Penalty" Subheader="{Binding InvestorStats.RecoveredToPenalty.ShortDecimalString, FallbackValue=0}">
                                <Card.HeaderStartContent>
                                    <ui:Icon Source="svg:/Assets/recovery.svg" />
                                </Card.HeaderStartContent>
                            </Card>
                            <Card Header="Projects In Recovery" Subheader="{Binding InvestorStats.ProjectsInRecovery, FallbackValue=0}">
                                <Card.HeaderStartContent>
                                    <ui:Icon Source="svg:/Assets/recovery.svg" />
                                </Card.HeaderStartContent>
                            </Card>
                        </BalancedWrapGrid>
                        <CardGrid ItemsSource="{Binding InvestedProjects}" MinColumnWidth="300" MaxColumnWidth="500">
                            <CardGrid.ItemTemplate>
                                <DataTemplate>
                                    <items:PortfolioProjectView />
                                </DataTemplate>
                            </CardGrid.ItemTemplate>
                        </CardGrid>
                    </StackPanel>
                </ScrollViewer>
            </Loading>
        </DockPanel>
    </a:PageContainer>
</UserControl>
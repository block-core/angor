<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:co="clr-namespace:AngorApp.UI.Controls"
             xmlns:manage="clr-namespace:AngorApp.Sections.Portfolio.Manage"
             xmlns:ui="clr-namespace:Zafiro.UI;assembly=Zafiro.UI"
             mc:Ignorable="d" d:DesignWidth="700" d:DesignHeight="800"
             x:Class="AngorApp.Sections.Portfolio.Manage.ManageInvestorProjectView" x:DataType="manage:IManageInvestorProjectViewModel">

    <Design.DataContext>
        <manage:ManageInvestorProjectViewModelDesign />
    </Design.DataContext>

    <!-- <UserControl.Resources> -->
    <!--     <DataTemplate x:Key="ActionsTemplate" DataType="manage:IInvestorProjectItem"> -->
    <!--         <Panel> -->
    <!--             <Panel.Styles> -->
    <!--                 <Style Selector="Button"> -->
    <!--                     <Setter Property="Width" Value="120" /> -->
    <!--                 </Style> -->
    <!--             </Panel.Styles> -->
    <!--             <Button Content="Recover" Command="{Binding Recover}" Opacity="{Binding ShowRecover, Converter={x:Static  OpacityConverters.BoolToOpacity}}" /> -->
    <!--             <Button Content="Release" Command="{Binding Release}" IsVisible="{Binding ShowRelease, Converter={x:Static  OpacityConverters.BoolToOpacity}}" /> -->
    <!--             <Button Content="End" Command="{Binding ClaimEndOfProject}" IsVisible="{Binding ShowClaimEndOfProject, Converter={x:Static  OpacityConverters.BoolToOpacity}}" /> -->
    <!--         </Panel> -->
    <!--     </DataTemplate> -->
    <!-- </UserControl.Resources> -->

    <co:PageContainer>
        <DockPanel VerticalSpacing="20">
            <Card DockPanel.Dock="Top" Theme="{StaticResource WideCard}" Header="Manage Investment" Subheader="{Binding Project.Name}">
                <Card.HeaderStartContent>
                    <ui:Icon Source="fa-list-check" />
                </Card.HeaderStartContent>
                <Card.HeaderEndContent>
                    <UniformGrid Rows="1" HorizontalAlignment="Stretch">
                        <Button Content="{Icon fa-arrows-rotate}" Command="{Binding Load}" />
                        <Button Content="Message" />
                    </UniformGrid>
                </Card.HeaderEndContent>
            </Card>
            <ScrollViewer>
                <StackPanel Classes="BigGap">
                    <!-- Info card for immediate claim -->
                    <Card IsVisible="{Binding CanClaimImmediately}" Classes="Success" Header="? No Penalty - Immediate Claim Available">
                        <TextBlock TextWrapping="Wrap">
                            Your investment is below the penalty threshold. You can claim your funds immediately without any penalty period or waiting for founder approval. Use the "Claim Now" buttons below to recover your funds instantly.
                        </TextBlock>
                    </Card>
                    
                    <BalancedWrapGrid MinItemWidth="200" HorizontalSpacing="20" VerticalSpacing="20">
                        <Card Header="Total Funds" Theme="{StaticResource LeftItemCard}" Subheader="{Binding Project.TotalFunds.DecimalString}" />
                        <Card Header="Expiry Date" Theme="{StaticResource LeftItemCard}" Subheader="{Binding Project.ExpiryDate, Converter={x:Static co:AngorConverters.HumanizeDateTime}}" />
                        <Card Header="Penalty Period" Theme="{StaticResource LeftItemCard}" Subheader="{Binding Project.PenaltyPeriod.TotalDays, StringFormat='{}{0} Days'}" />
                        <Card Header="Transaction" Theme="{StaticResource LeftItemCard}">
                            <Card.Subheader>
                                <Button Command="{Binding ViewTransaction}" FontSize="{StaticResource FontSizeSmall}" Content="View" />
                            </Card.Subheader>
                        </Card>
                    </BalancedWrapGrid>
                    <ResponsivePresenter Breakpoint="600">
                        <ResponsivePresenter.Narrow>
                            <ItemsControl Classes="ShowEmptyContent" Empty.Content="No release items found" ItemsSource="{Binding Items}">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Classes="BigGap" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Card Theme="{StaticResource WideCard}" Header="{ItemIndex StartFromOne=True, StringFormat='Stage {0}'}">
                                            <StackPanel Grid.IsSharedSizeScope="True" Classes="SmallGap">
                                                <EdgePanel Theme="{StaticResource PropertyEdgePanel}" StartContent="Stage:" Content="{Binding  Stage}" />
                                                <EdgePanel Theme="{StaticResource PropertyEdgePanel}" StartContent="Amount:" Content="{Binding Amount.DecimalString}" />
                                                <EdgePanel Theme="{StaticResource PropertyEdgePanel}" StartContent="Status:" Content="{Binding Status}" />
                                                <UniformGrid Rows="1" HorizontalAlignment="Center">
                                                    <Button Content="Recover" Command="{Binding Recover}" IsVisible="{Binding ShowRecover}" />
                                                    <Button Content="Release" Command="{Binding Release}" IsVisible="{Binding ShowRelease}" />
                                                    <Button Content="Claim End" Command="{Binding ClaimEndOfProject}" IsVisible="{Binding ShowClaimEndOfProject}" />
                                                    <Button Content="Claim Now" Command="{Binding ClaimImmediate}" IsVisible="{Binding ShowClaimImmediate}" Classes="Success" />
                                                </UniformGrid>
                                            </StackPanel>
                                        </Card>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ResponsivePresenter.Narrow>
                        <ResponsivePresenter.Wide>
                            <SlimDataGrid ItemsSource="{Binding Items}">
                                <SlimDataGrid.Columns>
                                    <Column Header="Stage" Binding="{Binding Stage}" />
                                    <Column Header="Amount" Binding="{Binding Amount.DecimalString}" />
                                    <Column Header="Status" Binding="{Binding Status}" />
                                    <Column Header="Actions">
                                        <Column.CellTemplate>
                                            <DataTemplate>
                                                <UniformGrid Rows="1">
                                                    <Button Content="Recover" Command="{Binding Recover}" IsVisible="{Binding ShowRecover}" />
                                                    <Button Content="Release" Command="{Binding Release}" IsVisible="{Binding ShowRelease}" />
                                                    <Button Content="Claim End" Command="{Binding ClaimEndOfProject}" IsVisible="{Binding ShowClaimEndOfProject}" />
                                                    <Button Content="Claim Now" Command="{Binding ClaimImmediate}" IsVisible="{Binding ShowClaimImmediate}" Classes="Success" />
                                                </UniformGrid>
                                            </DataTemplate>
                                        </Column.CellTemplate>
                                    </Column>
                                </SlimDataGrid.Columns>
                            </SlimDataGrid>
                        </ResponsivePresenter.Wide>
                    </ResponsivePresenter>
                </StackPanel>
            </ScrollViewer>
        </DockPanel>
    </co:PageContainer>
</UserControl>
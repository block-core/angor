<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:conv="clr-namespace:Zafiro.Avalonia.Converters;assembly=Zafiro.Avalonia"
             xmlns:misc="clr-namespace:Zafiro.Avalonia.Misc;assembly=Zafiro.Avalonia"
             xmlns:dt="clr-namespace:AngorApp.Sections.Browse.Details"
             xmlns:controls="clr-namespace:AngorApp.UI.Controls"
             xmlns:i="https://github.com/projektanker/icons.avalonia"
             mc:Ignorable="d" d:DesignWidth="650"
             x:Class="AngorApp.Sections.Browse.Details.NostProperties" x:DataType="dt:IProjectDetailsViewModel">

    <Design.DataContext>
        <dt:ProjectDetailsViewModelDesign />
    </Design.DataContext>

    <UserControl.Styles>
        <Style Selector="TextBox">
            <Setter Property="Padding" Value="10" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="IsReadOnly" Value="True" />
            <Setter Property="Background" Value="{DynamicResource SystemChromeLowColor}" />
            <Setter Property="FontFamily" Value="Consolas,Monaco,monospace" />
            <Setter Property="FontSize" Value="12" />
            <Setter Property="CornerRadius" Value="5" />
        </Style>
    </UserControl.Styles>

    <Card Header="Nostr Integration" Subheader="Decentralized communication and verification">
        <StackPanel Classes="BigGap">
            <!-- Nostr Keys Section -->
            <HeaderedContainer Header="Public Keys">
                <StackPanel Classes="BigGap">
                    <HeaderedContainer Header="NOSTR Public Key (NPub)" Classes="NoPadding">
                        <Border Classes="CardAlt">
                            <EdgePanel Theme="{StaticResource PropertyEdgePanel}">
                                <EdgePanel.StartContent>
                                    <i:Icon FontSize="16" Value="fa-solid fa-key" />
                                </EdgePanel.StartContent>
                                <SelectableTextBlock Text="{Binding Project.NostrNpubKeyHex, Converter={x:Static controls:AngorConverters.HexToNpub}}" />
                                <EdgePanel.EndContent>
                                    <Button Command="{Binding Source={x:Static misc:Commands.Instance}, Path=LaunchUri}"
                                            ToolTip.Tip="Open in Nostr Hub"
                                            Padding="8"
                                            CornerRadius="5">
                                        <Button.CommandParameter>
                                            <MultiBinding Converter="{x:Static conv:ZafiroStringConverters.Concat}">
                                                <Binding>
                                                    <Binding.Source>
                                                        <x:Uri>https://hub.angor.io/profile/</x:Uri>
                                                    </Binding.Source>
                                                </Binding>
                                                <Binding Path="Project.NostrNpubKeyHex" />
                                            </MultiBinding>
                                        </Button.CommandParameter>
                                        <Button.Content>
                                            <i:Icon FontSize="14" Value="fa-solid fa-external-link-alt" />
                                        </Button.Content>
                                    </Button>
                                </EdgePanel.EndContent>
                            </EdgePanel>
                        </Border>
                    </HeaderedContainer>

                    <HeaderedContainer Header="NOSTR Public Key (Hex)" Classes="NoPadding">
                        <Border Classes="CardAlt">
                            <EdgePanel Theme="{StaticResource PropertyEdgePanel}" StartContent="{Icon fa-solid fa-hashtag}">
                                <SelectableTextBlock Text="{Binding Project.NostrNpubKeyHex}" />
                                <EdgePanel.EndContent>
                                    <Button Command="{Binding Source={x:Static misc:Commands.Instance}, Path=LaunchUri}"
                                            ToolTip.Tip="Open in Nostr Hub"
                                            Padding="8"
                                            CornerRadius="5">
                                        <Button.CommandParameter>
                                            <MultiBinding Converter="{x:Static conv:ZafiroStringConverters.Concat}">
                                                <Binding>
                                                    <Binding.Source>
                                                        <x:Uri>https://hub.angor.io/profile/</x:Uri>
                                                    </Binding.Source>
                                                </Binding>
                                                <Binding Path="Project.NostrNpubKeyHex" />
                                            </MultiBinding>
                                        </Button.CommandParameter>
                                        <Button.Content>
                                            <i:Icon FontSize="14" Value="fa-solid fa-external-link-alt" />
                                        </Button.Content>
                                    </Button>
                                </EdgePanel.EndContent>
                            </EdgePanel>
                        </Border>
                    </HeaderedContainer>
                </StackPanel>

            </HeaderedContainer>

            <!-- Nostr Relays Section -->
            <HeaderedContainer>
                <HeaderedContainer.Header>
                    <StackPanel Orientation="Horizontal" Spacing="10">
                        <i:Icon FontSize="20" Value="fa-solid fa-satellite-dish" />
                        <TextBlock Text="Nostr Relays" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center" />
                        <Border Background="Orange"
                                CornerRadius="10"
                                Padding="8,4"
                                VerticalAlignment="Center">
                            <TextBlock Text="{Binding Relays, Converter={x:Static Enumerable.Count}}"
                                       FontSize="12"
                                       FontWeight="Bold"
                                       Foreground="White" />
                        </Border>
                    </StackPanel>
                </HeaderedContainer.Header>

                <StackPanel Classes="BigGap">
                    <ItemsControl ItemsSource="{Binding Relays}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Classes="SmallGap" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Classes="CardAlt">
                                    <EdgePanel Theme="{StaticResource PropertyEdgePanel}">
                                        <EdgePanel.StartContent>
                                            <StackPanel Orientation="Horizontal" Spacing="10">
                                                <i:Icon FontSize="16" Value="fa-solid fa-broadcast-tower" />
                                                <TextBlock Text="Relay" FontSize="12" Opacity="0.7" VerticalAlignment="Center" />
                                            </StackPanel>
                                        </EdgePanel.StartContent>
                                        <EdgePanel.Content>
                                            <SelectableTextBlock Text="{Binding Uri}"
                                                                 FontFamily="Consolas,Monaco,monospace"
                                                                 FontSize="12"
                                                                 VerticalAlignment="Center" />
                                        </EdgePanel.Content>
                                        <EdgePanel.EndContent>
                                            <Button Command="{Binding Source={x:Static misc:Commands.Instance}, Path=LaunchUri}"
                                                    CommandParameter="{Binding Uri}"
                                                    ToolTip.Tip="Open relay URL"
                                                    Padding="8"
                                                    CornerRadius="5">
                                                <Button.Content>
                                                    <i:Icon FontSize="14" Value="fa-solid fa-external-link-alt" />
                                                </Button.Content>
                                            </Button>
                                        </EdgePanel.EndContent>
                                    </EdgePanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </HeaderedContainer>

        </StackPanel>
    </Card>

</UserControl>
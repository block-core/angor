<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:zc="clr-namespace:Zafiro.Avalonia.Controls;assembly=Zafiro.Avalonia"
             xmlns:dt="clr-namespace:AngorApp.Sections.Browse.Details"
             xmlns:i="https://github.com/projektanker/icons.avalonia"
             xmlns:controls="clr-namespace:AngorApp.UI.Controls"
             mc:Ignorable="d" d:DesignWidth="400"
             x:Class="AngorApp.Sections.Browse.Details.ProjectSummary" x:DataType="dt:IProjectDetailsViewModel">

    <Design.DataContext>
        <dt:ProjectDetailsViewModelDesign />
    </Design.DataContext>

    <Card Header="Project Summary" Subheader="Key metrics and progress tracking">
        <Card.HeaderStartContent>
            <i:Icon FontSize="40" Value="fa-solid fa-chart-line" />
        </Card.HeaderStartContent>

        <StackPanel Spacing="25" Margin="0 10 0 0">
            <!-- Progress Overview Cards -->
            <BalancedWrapGrid MinItemWidth="250" HorizontalSpacing="20" VerticalSpacing="20">
                <Card Theme="{StaticResource TransparentCard}"
                      Header="Timeline Progress"
                      Subheader="{Binding Project.TimeFromFundingStartingDate.TotalDays, StringFormat={}{0:0} days elapsed}">
                    <Card.HeaderStartContent>
                        <i:Icon FontSize="30" Value="fa-solid fa-calendar-check" />
                    </Card.HeaderStartContent>
                    <Card.Content>
                        <StackPanel Spacing="15">
                            <Panel Height="100">
                                <zc:CircularProgressBar MaxWidth="100"
                                                        Maximum="{Binding Project.FundingPeriod.TotalDays}"
                                                        Value="{Binding Project.TimeFromFundingStartingDate.TotalDays}"
                                                        Foreground="{DynamicResource SystemAccentColor}" />
                                <TextBlock VerticalAlignment="Center"
                                           HorizontalAlignment="Center"
                                           FontSize="14"
                                           FontWeight="Bold">
                                    <TextBlock.Text>
                                        <MultiBinding StringFormat="{}{0:0}/{1:0}">
                                            <Binding Path="Project.TimeFromFundingStartingDate.TotalDays" />
                                            <Binding Path="Project.FundingPeriod.TotalDays" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Panel>
                            <TextBlock Text="{Binding Project.FundingPeriod.TotalDays, StringFormat='Total: {0:0} days'}"
                                       HorizontalAlignment="Center"
                                       FontSize="12"
                                       Opacity="0.7" />
                        </StackPanel>
                    </Card.Content>
                </Card>

                <Card Theme="{StaticResource TransparentCard}"
                      Header="Funding Progress"
                      Subheader="{Binding Project.RaisedAmount.DecimalString, StringFormat={}{0} raised}">
                    <Card.HeaderStartContent>
                        <i:Icon FontSize="30" Value="fa-solid fa-coins" />
                    </Card.HeaderStartContent>
                    <Card.Content>
                        <StackPanel Spacing="15">
                            <Panel Height="100">
                                <zc:CircularProgressBar MaxWidth="120"
                                                        x:Name="Funding"
                                                        Maximum="{Binding Project.TargetAmount.Sats}"
                                                        Value="{Binding Project.RaisedAmount.Sats}"
                                                        Foreground="Orange" />
                                <TextBlock Text="{Binding #Funding.Proportion, StringFormat={}{0:P0}}"
                                           VerticalAlignment="Center"
                                           HorizontalAlignment="Center"
                                           FontSize="14"
                                           FontWeight="Bold"
                                           Foreground="Orange" />
                            </Panel>
                            <TextBlock Text="{Binding Project.TargetAmount.DecimalString, StringFormat='Target: {0}'}"
                                       HorizontalAlignment="Center"
                                       FontSize="12"
                                       Opacity="0.7" />
                        </StackPanel>
                    </Card.Content>
                </Card>
            </BalancedWrapGrid>

            <Card Header="Project Information" Subheader="Key project details and metrics">
                <StackPanel Classes="BigGap" Margin="0 15">
                    <StackPanel Classes="BigGap">
                        <EdgePanel Theme="{StaticResource PropertyEdgePanel}" StartContentTemplate="{StaticResource RegularIcon}" StartContent="{Icon fa-bullseye}" Content="Target amount"
                                   EndContent="{Binding Project.TargetAmount.DecimalString}" />
                        <EdgePanel Theme="{StaticResource PropertyEdgePanel}" StartContentTemplate="{StaticResource RegularIcon}" StartContent="{Icon fa-solid fa-clock}" Content="Penalty duration"
                                   EndContent="{Binding Project.PenaltyDuration, Converter={x:Static controls:AngorConverters.HumanizeTimeSpan}}" />
                        <EdgePanel Theme="{StaticResource PropertyEdgePanel}" StartContentTemplate="{StaticResource RegularIcon}" StartContent="{Icon fa-solid fa-calendar-days}" Content="Project dates">
                            <EdgePanel.EndContent>
                                <StackPanel>
                                    <TextBlock HorizontalAlignment="Right" Text="{Binding Project.FundingStartDate, StringFormat=d}" />
                                    <TextBlock HorizontalAlignment="Right" Text="{Binding Project.FundingEndDate, StringFormat=d}" />
                                </StackPanel>
                            </EdgePanel.EndContent>
                        </EdgePanel>
                        <EdgePanel Theme="{StaticResource PropertyEdgePanel}" StartContentTemplate="{StaticResource RegularIcon}" StartContent="{Icon fa-solid fa-users}" Content="Total raised"
                                   EndContent="{Binding Project.RaisedAmount.DecimalString}" />
                        <EdgePanel Theme="{StaticResource PropertyEdgePanel}" StartContentTemplate="{StaticResource RegularIcon}" StartContent="{Icon fa-solid fa-calculator}" Content="Total investors"
                                   EndContent="{Binding Project.TotalInvestors, TargetNullValue='Unknown'}" /></StackPanel>
                    <Separator />
                    <HyperlinkButton HorizontalAlignment="Stretch">
                        <DockPanel HorizontalSpacing="15">
                            <ContentControl Content="{Icon fa-solid fa-external-link-alt}" />
                            <TextBlock TextWrapping="Wrap">View the transaction on the explorer</TextBlock>
                        </DockPanel>
                    </HyperlinkButton>

                </StackPanel>
            </Card>
        </StackPanel>
    </Card>
</UserControl>
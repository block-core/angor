<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:controls="clr-namespace:AngorApp.UI.Shared.Controls"
             xmlns:settings="clr-namespace:AngorApp.UI.Sections.Settings"
             xmlns:fa="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
             xmlns:i="https://github.com/projektanker/icons.avalonia"
             mc:Ignorable="d" d:DesignWidth="1200"
             x:Class="AngorApp.UI.Sections.Settings.SettingsSectionView"
             x:DataType="settings:ISettingsSectionViewModel">

    <Design.DataContext>
        <settings:SettingsSectionViewModelSample />
    </Design.DataContext>

    <UserControl.Styles>
        <Style Selector="Card">
            <Setter Property="Theme" Value="{StaticResource WideCard}" />
        </Style>

        <Style Selector="Card DockPanel">
            <Setter Property="HorizontalSpacing" Value="10" />
        </Style>

        <Style Selector="Card DockPanel EnhancedButton">
            <Setter Property="DockPanel.Dock" Value="Right" />
        </Style>

        <Style Selector="Card DockPanel TextBox">
            <Setter Property="VerticalContentAlignment" Value="Center" />
        </Style>

        <Style Selector="Card StackPanel">
            <Setter Property="Spacing" Value="10" />
        </Style>
        <!-- Status Badge Styles -->
        <Style Selector="Badge[Tag=Unknown]">
            <Setter Property="Color" Value="Gray" />
        </Style>
        <Style Selector="Badge[Tag=Online]">
            <Setter Property="Color" Value="{DynamicResource SuccessColor}" />
        </Style>
        <Style Selector="Badge[Tag=Offline]">
            <Setter Property="Color" Value="{DynamicResource ErrorColor}" />
        </Style>
        <Style Selector="Badge[Tag=NotReady]">
            <Setter Property="Color" Value="{DynamicResource WarningColor}" />
        </Style>

        <!-- Link styling for URLs -->
        <Style Selector="SlimDataGrid TextBlock.Link">
            <Setter Property="Foreground" Value="{DynamicResource SuccessColor}" />
        </Style>

        <!-- Trash button styling -->
        <Style Selector="EnhancedButton.Trash">
            <Setter Property="Foreground" Value="{DynamicResource ErrorColor}" />
        </Style>

    </UserControl.Styles>

    <controls:PageContainer>
        <ScrollViewer IconOptions.Size="{StaticResource IconSizeSmall}">
            <StackPanel Classes="Gap-XL" MaxWidth="700">
                
                <!-- Network Section -->
                <Card HeaderStartContent="{Icon fa-globe}" Header="Network">
                    <Card.HeaderEndContent>
                        <EnhancedButton Classes="Primary" Icon="{Icon fa-plus}" Content="Change Network" Command="{Binding ChangeNetwork}" />
                    </Card.HeaderEndContent>
                    <StackPanel Orientation="Horizontal" Spacing="10" VerticalAlignment="Center">
                        <TextBlock Text="Network Type:" VerticalAlignment="Center" />
                        <TextBlock Text="{Binding Network}" FontWeight="Bold" VerticalAlignment="Center" />
                    </StackPanel>
                </Card>

                <!-- Indexer Section -->
                <Card HeaderStartContent="{Icon fa-server}" Header="Indexer">
                    <Card.HeaderEndContent>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <EnhancedButton Classes="Primary" Icon="{Icon fa-plus}" Content="Add" Command="{Binding AddIndexer}" />
                            <EnhancedButton Classes="Primary" Content="Refresh" Command="{Binding RefreshIndexers}">
                                <EnhancedButton.Icon>
                                    <Panel>
                                        <i:Icon Value="fa-rotate-right" IsVisible="{Binding !RefreshIndexers.IsExecuting^}" />
                                        <fa:ProgressRing Width="16" Height="16" IsVisible="{Binding RefreshIndexers.IsExecuting^}" />
                                    </Panel>
                                </EnhancedButton.Icon>
                            </EnhancedButton>
                        </StackPanel>
                    </Card.HeaderEndContent>
                    <StackPanel>
                        <TextBox Watermark="Enter new indexer link" Text="{Binding NewIndexer}" Margin="0 0 0 10" />
                        <SlimDataGrid ItemsSource="{Binding Indexers}">
                            <SlimDataGrid.Columns>
                                <Column Header="Link" Width="*">
                                    <Column.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Classes="Link" Text="{Binding Url}" />
                                        </DataTemplate>
                                    </Column.CellTemplate>
                                </Column>
                                <Column Header="Status" Width="Auto">
                                    <Column.CellTemplate>
                                        <DataTemplate>
                                            <Badge Content="{Binding Status}" Tag="{Binding Status}" />
                                        </DataTemplate>
                                    </Column.CellTemplate>
                                </Column>
                                <Column Header="Default" Width="Auto">
                                    <Column.CellTemplate>
                                        <DataTemplate>
                                            <CheckBox IsChecked="{Binding IsPrimary}" Command="{Binding SetPrimary}" IsEnabled="{Binding !IsPrimary}" />
                                        </DataTemplate>
                                    </Column.CellTemplate>
                                </Column>
                                <Column Width="Auto" Binding="{Binding}">
                                    <Column.CellTemplate>
                                        <DataTemplate>
                                            <EnhancedButton Classes="Trash" Icon="{Icon fa-trash}" Command="{Binding Remove}" />
                                        </DataTemplate>
                                    </Column.CellTemplate>
                                </Column>
                            </SlimDataGrid.Columns>
                        </SlimDataGrid>
                    </StackPanel>
                </Card>

                <!-- Nostr Relays Section -->
                <Card HeaderStartContent="{Icon mdi-antenna}" Header="Nostr Relays">
                    <Card.HeaderEndContent>
                        <StackPanel Orientation="Horizontal" Spacing="10">
                            <EnhancedButton Classes="Primary" Icon="{Icon fa-plus}" Content="Add" Command="{Binding AddRelay}" />
                            <EnhancedButton Classes="Primary" Content="Refresh" Command="{Binding RefreshRelays}">
                                <EnhancedButton.Icon>
                                    <Panel>
                                        <i:Icon Value="fa-rotate-right" IsVisible="{Binding !RefreshRelays.IsExecuting^}" />
                                        <fa:ProgressRing Width="16" Height="16" IsVisible="{Binding RefreshRelays.IsExecuting^}" />
                                    </Panel>
                                </EnhancedButton.Icon>
                            </EnhancedButton>
                        </StackPanel>
                    </Card.HeaderEndContent>
                    <StackPanel>
                        <TextBox Watermark="Enter new relay link" Text="{Binding NewRelay}" Margin="0 0 0 10" />
                        <SlimDataGrid ItemsSource="{Binding Relays}">
                            <SlimDataGrid.Columns>
                                <Column Header="Link" Width="*">
                                    <Column.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Classes="Link" Text="{Binding Url}" />
                                        </DataTemplate>
                                    </Column.CellTemplate>
                                </Column>
                                <Column Header="Name" Binding="{Binding Name}" Width="Auto" />
                                <Column Header="Status" Width="Auto">
                                    <Column.CellTemplate>
                                        <DataTemplate>
                                            <Badge Content="{Binding Status}" Tag="{Binding Status}" />
                                        </DataTemplate>
                                    </Column.CellTemplate>
                                </Column>
                                <Column Width="Auto" Binding="{Binding}">
                                    <Column.CellTemplate>
                                        <DataTemplate>
                                            <EnhancedButton Classes="Trash" Icon="{Icon fa-trash}" Command="{Binding Remove}" />
                                        </DataTemplate>
                                    </Column.CellTemplate>
                                </Column>
                            </SlimDataGrid.Columns>
                        </SlimDataGrid>
                    </StackPanel>
                </Card>

                <!-- Currency Display Section -->
                <Card HeaderStartContent="{Icon fa-bitcoin}" Header="Currency Display">
                    <StackPanel Classes="Gap-XL">
                        <StackPanel Orientation="Horizontal" Spacing="15">
                            <TextBlock Text="Select Currency:" VerticalAlignment="Center" />
                            <ToggleSwitch IsChecked="{Binding IsBitcoinPreferred}" OnContent="Bitcoin (BTC)" OffContent="Satoshis (sats)" />
                        </StackPanel>
                        <TextBlock Classes="Muted Wrap" Text="Bitcoin-only application - currency display is fixed to BTC or sats." />
                    </StackPanel>
                </Card>

                <!-- Debug Mode Section (Testnet only) -->
                <Card Header="Debug Mode" IsVisible="{Binding IsTestnet}">
                    <StackPanel Classes="Gap-XL">
                        <TextBlock Classes="Wrap Muted">Debug mode is only available on testnet networks. When enabled, additional debugging features will be available.</TextBlock>
                        <ToggleSwitch IsChecked="{Binding IsDebugMode}" Content="Debug Mode" OnContent="Enabled" OffContent="Disabled" HorizontalAlignment="Left" />
                    </StackPanel>
                </Card>

                <!-- Backup Account Section -->
                <Card HeaderStartContent="{Icon fa-download}" Header="Backup Account" IsVisible="{Binding HasWallet}">
                    <StackPanel Classes="Gap-XL">
                        <TextBlock Classes="Wrap Muted">Download a backup of your account (seed) so you never lose access.</TextBlock>
                        <EnhancedButton HorizontalAlignment="Left" Icon="{Icon fa-download}" Content="Download Backup" Command="{Binding BackupWallet}" />
                    </StackPanel>
                </Card>

                <!-- Wallet Section -->
                <Card HeaderStartContent="{Icon fa-wallet}" Header="Wallet" IsVisible="{Binding !HasWallet}">
                    <StackPanel Classes="Gap-XL">
                        <TextBlock Classes="Wrap Muted">Import an existing wallet using your recovery words.</TextBlock>
                        <EnhancedButton HorizontalAlignment="Right" Command="{Binding ImportWallet}" Content="Import wallet" />
                    </StackPanel>
                </Card>

                <!-- Danger Zone Section -->
                <Card BorderBrush="{StaticResource DangerColor}" BorderThickness="3" HeaderStartContent="{Icon mdi alert-outline}" Header="Danger Zone">
                    <Card.HeaderEndContent>
                        <TextBlock Classes="Muted" Text="Irreversible actions" VerticalAlignment="Center" />
                    </Card.HeaderEndContent>
                    <EnhancedButton HorizontalAlignment="Left" Classes="Danger" Icon="{Icon fa-trash}" Content="Wipe Data" Command="{Binding WipeData}" />
                </Card>
                
            </StackPanel>
        </ScrollViewer>
    </controls:PageContainer>
</UserControl>
